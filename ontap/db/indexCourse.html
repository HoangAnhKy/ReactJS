<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
            crossorigin="anonymous" />
        <title>API</title>
    </head>
    <body class="container mt-5">
        <div class="d-flex justify-content-start">
            <button class="btn btn-primary" onclick="getAPI()">Get API</button>
            <button class="btn btn-primary mx-2" onclick="opendFrom()">Add Course</button>
        </div>

        <div id="addCourse" class="d-none">
            <div class="mt-2">
                <form id="formSendAPI">
                    <input type="text" name="nameCourse" placeholder="name Course" class="mb-2 form-control" />
                    <button class="btn btn-success form-control sendAPI" type="send">Submit</button>
                </form>
            </div>
        </div>
        <div id="root"></div>
    </body>
    <script>
        const url = 'http://localhost:3000/courses';
        let flag_show = false;
        let render = document.querySelector('#root');

        // CURD
        const runFetch = (url = null, callback = null, method = 'GET', data = []) => {
            let option = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            };

            if (method === 'GET') {
                option = {};
            }

            fetch(url, option)
                .then((data) => data.json())
                .then(callback);
        };

        // get data API
        const getAPI = () => {
            let html = '';
            flag_show = flag_show ? false : true;
            if (flag_show) {
                runFetch(url, (reponser) => {
                    reponser.map((obj) => {
                        html += `<li class="mt-2">${obj.nameCourse} <button class="btn btn-danger" onClick="deleteAPI(${obj.id})">Delete</button></li>`;
                    });
                    render.innerHTML = html;
                });
            } else {
                render.innerHTML = html;
            }
        };

        // show form input
        const opendFrom = () => {
            let btn_add = document.getElementById('addCourse');
            btn_add.classList.toggle('d-none');
        };

        // sendAPI
        let sendAPI = document.querySelector('.sendAPI');
        sendAPI.addEventListener('click', function (e) {
            e.preventDefault();
            // get dataFromn
            let data = {
                nameCourse: document.querySelector('input[name="nameCourse"]').value,
            };
            runFetch(
                url,
                (reponser) => {
                    console.log(reponser);
                },
                'POST',
                data
            );
        });

        // Delete

        const deleteAPI = (id) => {
            newURL = url + '/' + id;
            runFetch(
                newURL,
                (reponser) => {
                    reponser.map((obj) => {
                        html += `<li class="mt-2">${obj.nameCourse} <button class="btn btn-danger" >Delete</button></li>`;
                    });
                    render.innerHTML = html;
                },
                'DELETE'
            );
        };
    </script>
</html>
